<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: INSTALLATION
  
    &mdash; VISoR
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: INSTALLATION</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Installing VISOR</h1>

<h2>Deployment Environment</h2>

<p>We will install VISOR by distributing its components across 3 machines, with two servers and one client machine. The enviroment arrangment goes as follows:</p>

<p><strong>Server 1:</strong> This server will be used to deploy the VISOR Image System (VIS), which is VISOR's core and client's front-end. The VIS server will make use of a logging file in which it logs its operations. This machine will also contain a VISOR configuration file (VCF) which will contain the necessary configuration options for the VIS operation.</p>

<p><strong>Server 2:</strong> This server will host both VISOR Meta System (VMS) and VISOR Auth System (VAS). Therefore it will use an underlying database to store both user accounts and image metadata. Both VMS and VAS will log their operations to a local log file. This server will also host another VCF which will contain the necessary parameters to configure both VMS and VAS.</p>

<p><strong>Client:</strong> The Client machine will host the VIS command-line interface (CLI), which will communicate with the VIS hosted in Server 1. It will also contain a VCF containing the necessary parameters to configure the CLI.</p>

<p>Next we will present the VISOR installation requirements. We will indicate in which machines the necessary procedures should be conducted.</p>

<h2>Installing Dependencies</h2>

<h3>Ruby</h3>

<p>This procedures should be reproduced in all host machines: <strong>Server 1</strong>, <strong>Server 2</strong> and <strong>Client</strong> machines.</p>

<p>VISOR mostly depends on Ruby, thus all machines used to host VISOR need to have the Ruby binaries. Since VISOR targets Unix systems, currently, most up to date Linux and Mac OSX operating systems (OSs) have Ruby already installed. Although VISOR requires Ruby to be at least in version 1.9.2. To ensure that host machines fulfil this requirement open a terminal windows and issue the following command:</p>

<pre class="code ruby"><code>prompt&gt; ruby -v
ruby 1.9.3p0
</code></pre>

<p>In the above output our testing host machine has Ruby version 1.9.3 installed. If you do not see a similar response, with Ruby being at least in version 1.9.2 or if you receive a "command not found" error, then you need to install Ruby in order to proceed. We will prefer the most recent version till date, Ruby 1.9.3. You can install it as follows depdending on the hosts used OS.</p>

<h4>Debian/Ubuntu</h4>

<pre class="code ruby"><code>prompt&gt; sudo apt-get get update
# Install build-essential (essential tools to build any applications)
prompt&gt; sudo apt-get install build-essential
prompt&gt; sudo apt-get install ruby1.9.3
</code></pre>

<h4>Fedora/Red Hat/CentOS</h4>

<pre class="code ruby"><code>prompt&gt; sudo yum update
prompt&gt; sudo apt-get install ruby1.9.3
</code></pre>

<h4>Mac OSX</h4>

<p>In Mac OSX make sure you have installed Apple's Xcode before proceed.</p>

<pre class="code ruby"><code># Install Homebrew, a free Mac OSX package manager
prompt&gt; /usr/bin/ruby -e &quot;$(/usr/bin/curl -fsSL https://raw.github.com/mxcl/homebrew/master/Library/Contributions/install_homebrew.rb)&quot;
# Now install ruby
prompt&gt; brew install ruby
</code></pre>

<h3>Database System</h3>

<p>This procedures should be reproduced in the <strong>Server 2</strong>.</p>

<p>In order to let VMS and VAS register data on an underlying database, it is needed to install the wanted database system. Both VMS and VAS support MongoDB and MySQL databases, therefore it is user's responsibility to choose which one to install and use. Choose either to install MongoDB or MySQL using the following instructions.</p>

<h4>Debian/Ubuntu</h4>

<pre class="code ruby"><code># Install MongoDB (Optional)
prompt&gt; sudo apt-get install mongodb
# Install MySQL (Optional)
prompt&gt; sudo apt-get install mysql-server mysql-client libmysqlclient-dev
</code></pre>

<h4>Mac OSX</h4>

<pre class="code ruby"><code># Install MongoDB (Optional)
prompt&gt; brew install mongodb
# Install MySQL (Optional)
prompt&gt; brew install mysql
</code></pre>

<h2>Configuring the VISOR Database</h2>

<p>This procedures should be reproduced in the <strong>Server 2</strong>.</p>

<p>Now that all dependencies are satisfied, it is time to configure a database for VISOR. Follow the following instructions if you have choose either MongoDB or MySQL.</p>

<h3>MongoDB</h3>

<p>Just make sure that MongoDB was successfully installed, no further configurations are needed, as VISOR will handle databases creation automatically.</p>

<pre class="code ruby"><code>prompt&gt; mongo
MongoDB shell version: 2.0.4
connecting to: test
&gt;
</code></pre>

<p>If you see something like the above output everything should be fine. Type <code>exit</code> to quit from the MongoDB shell.</p>

<h3>MySQL</h3>

<p>If you have choose to run VISOR backed by MySQL you need to create and configure a database and an user account like follows:</p>

<pre class="code ruby"><code># Type the following to enter in MySQL shell
prompt&gt; mysql -u root
</code></pre>

<p>Now you should be already inside MySQL shell, type the following SQL queries to create a database and an user account for it (you can modify the following username and password for whatever you want, just make sure note those credentials as they will be further required):</p>

<pre class="code ruby"><code>CREATE DATABASE visor;
CREATE USER 'visor'@'%' IDENTIFIED BY 'passwd';
GRANT ALL PRIVILEGES ON *.* TO 'visor'@'%';
FLUSH PRIVILEGES;
</code></pre>

<p>If everything went alright, we now have completed the databases configurations. Just type <code>exit;</code> to quit from the MySQL shell.</p>

<h2>Installing VISOR</h2>

<p>We have already prepared the host machine to host VISOR services. Thus, we can now fetch and install VISOR subsystems. VISOR is distributed as a set of subsystems packaged in Ruby libraries, which are commonly known as "gems". Therefore we will install each VISOR subsystem with a single command, fetching the required gem that will automatically install and configure the required VISOR subsystem.</p>

<p>Here in front, all commands are the same for all popular Unix based OSs (e.g. Ubuntu, Fedora, CentOS, RedHat, Mac OSX and others).</p>

<h3>VISOR Auth and Meta Systems</h3>

<p>This procedures should be reproduced in <strong>Server 2</strong>. We will now install VAS and VMS subsystems. After successfully configured a database for VISOR, to install these system issue simply issue the following command:</p>

<pre class="code ruby"><code>prompt&gt; gem install visor-auth visor-meta
</code></pre>

<p>This command will automatically fetch, install and configure the last releases of VAS and VMS from the Ruby gems on-line repository. During VAS and VMS installing the VISOR Common System (VCS) will be automatically fetched and installed too (being it the <code>visor-common</code> gem), as it is the first dependency of all VISOR subsystems. After the install has been succeeded we will see the following terminal output:</p>

<pre class="code ruby"><code>prompt $&gt; gem install visor-auth visor-meta

Successfully installed visor-common-0.0.2

****************************** VISOR ******************************
visor-auth was successfully installed!

Generate the VISOR configuration file for this machine (if not already done) by running the 'visor-config' command.
*******************************************************************

Successfully installed visor-auth-0.0.2

****************************** VISOR ******************************
visor-meta was successfully installed!

Generate the VISOR configuration file for this machine (if not already done) by running the 'visor-config' command.
*******************************************************************

Successfully installed visor-meta-0.0.2
2 gems installed
prompt $&gt; |
</code></pre>

<p>As can be seen in the above output, both <code>visor-auth</code> (line 12) and <code>visor-meta</code> (line 21) were successful installed, with <code>visor-common</code> being automatically installed prior to them (line 3). After being installed both VAS and VMS display an informative message (lines 5-10 and 14-19 respectively) indicating that they were successful installed and now the user should generate the VISOR configuration file for their host.</p>

<h4>Generating the VISOR Configuration File</h4>

<p>To generate a template configuration file for the VAS and VMS host for the first time they were installed, the <code>visor-config</code> command should be used:</p>

<pre class="code ruby"><code>prompt $&gt; visor-config

Generating VISOR configuration directories and files:

creating /Users/joaodrp/.visor...                  [DONE]
creating /Users/joaodrp/.visor/logs...             [DONE]
creating /Users/joaodrp/.visor/visor-config.yml... [DONE]

All configurations were successful. Now open and customize the VISOR configuration file at /Users/joaodrp/.visor/visor-config.yml

prompt $&gt; 
</code></pre>

<p>As listed in the output above, they were generated the VISOR configuration files and directories. These include the <a href="http://www.yaml.org/spec/1.2/spec.html">YAML format</a> VISOR configuration file named <code>visor-config.yml</code>, the <code>logs</code> directory for where both VAS and VMS servers will log, and the parent <code>.visor</code> folder placed in the user's home folder, in this case <code>/Users/joaodrp/</code>.</p>

<h4>Customize the VISOR Configuration File</h4>

<p>Now the configuration file should be opened and customized. The full generated configuration file template is listed in <a href="http://www.cvisor.org/display/DOCS/configuration_file">VISOR Configuration File</a>. Here we will only address the parts of the configuration file that should be customized now. The rest of the parameters can be leaved as they are on the template.</p>

<pre class="code ruby"><code>...
# ================================ VISoR Auth =================================
#
visor_auth:
    # Merge default configuration
    &lt;&lt;: *default
    # Address to bind the meta server
    bind_host: 0.0.0.0
    # Port to bind the meta server
    bind_port: 4566
    # Backend connection string (syntax: name://user:pass@host:port/database)
    #backend: mongodb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:27017/visor
    #backend: mysql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:3306/visor
    # Log file name (available: filename or empty for STDOUT)
    log_file: visor-auth-server.log
    # Log level to start logging events (available: DEBUG, INFO)
    log_level: INFO

# ================================ VISoR Meta =================================
#
visor_meta:
    # Merge default configuration
    &lt;&lt;: *default
    # Address to bind the meta server
    bind_host: 0.0.0.0
    # Port to bind the meta server
    bind_port: 4567
    # Backend connection string (syntax: name://user:pass@host:port/database)
    #backend: mongodb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:27017/visor
    #backend: mysql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:3306/visor
    # Log file name (available: filename or empty for STDOUT)
    log_file: visor-meta-server.log
    # Log level to start logging events (available: DEBUG, INFO)
    log_level: INFO
...
</code></pre>

<p>The output above contains the excerpts of the VCF that can be now customized. The template comes already filled in most attributes to what that should be the preferred options of users. Here users can change the host and port address to bind the VAS server (lines 8 and 10). They can also customize the database backend options for either MongoDB (line 12) or MySQL (line 13), depending on the chosen database system, as also customize the log file to which VAS should log operations and the level of debugging. The same parameters apply to the VMS too, as they have the same configuration parameters.</p>

<p>We will leave almost all fields with the default values but the <code>backend</code> parameter. The parameter should be filled with the configurations previously made back in Section \refsec:config_database. Lets consider that one has chosen MongoDB, therefore, it should uncomment lines 12 and 30, and fill the necessary attributes. Considering that MongoDB is listening on its default host and port address, with no authentication and using "visor" as the database name, lines 12 and 30 need to be set to (making sure to respect lines indentation):</p>

<p>   backend: mongodb://:@127.0.0.1:27017/visor</p>

<p>If one has chosen MySQL, lines 12 and 30 should be filled with the attributes obtained back in Section \refsec:config_database as follows:</p>

<p>   backend: mysql://visor:passwd@127.0.0.1:3306/visor</p>

<p>After that, save the configuration file and quit from the text editor.</p>

<h4>Generating an User Account</h4>

<p>In order to authenticate against VISOR, one should first create an user account. This is done in VAS, using the <code>visor-admin</code> command.</p>

<pre class="code ruby"><code>prompt $&gt; visor-admin
Usage: visor-admin &lt;command&gt; [options]

Commands:
     list           Show all registered users
     get            Show a specific user
     add            Register a new user
     update         Update an user
     delete         Delete an user
     clean          Delete all users
     help &lt;cmd&gt;     Show help message for one of the above commands

Options:
    -a, --access KEY                 The user access key (username)
    -e, --email ADDRESS              The user email address
    -q, --query QUERY                HTTP query like string to filter results

Common options:
    -v, --verbose                    Enable verbose
    -h, --help                       Show this help message
    -V, --version                    Show version
prompt $&gt; 
</code></pre>

<p>Issuing the <code>visor-admin</code> command without any arguments shows the help message above. It is possible to ask for help on how to add a new user by issuing the following command:</p>

<pre class="code ruby"><code>prompt $&gt; visor-admin help add
Usage: visor-admin add &lt;ATTRIBUTES&gt; [options]

Add a new user, providing its attributes.

The following attributes can be specified as key/value pairs:

  access_key: The wanted user access key (username)
       email: The user email address

Examples:
  $ visor-admin add access_key=foo email=foo@bar.com
prompt $&gt; 
</code></pre>

<p>Lets follow the above example to add a new user account for user 'foo':</p>

<pre class="code ruby"><code>prompt $&gt; visor-admin add access_key=foo email=foo@bar.com
Successfully added new user with access key 'foo'.

        ID: 8a65ab69-59b3-4efc-859a-200e6341786e         
ACCESS_KEY: foo
SECRET_KEY: P1qGJkJqWNEwwpSyWbh4cUljxkxbdTwen6m/pwF2            
     EMAIL: foo@bar.com
CREATED_AT: 2012-06-10 16:31:01 UTC      
prompt $&gt;
</code></pre>

<p>With a new user account created, now it is time to fill our user credentials in the VCF, opening it and filling the following fields with the obtained results of the command above (use the access key and secret key that you have retrieved with the above command):</p>

<pre class="code ruby"><code># ====== Default always loaded configuration throughout VISOR sub-systems =====
#
default: &amp;default
    ...
    # VISoR access and secret key credentials, grab yours from $ visor-admin
    access_key: foo
    secret_key: P1qGJkJqWNEwwpSyWbh4cUljxkxbdTwen6m/pwF2
...
</code></pre>

<h4>Starting the VISOR Auth and Meta Systems</h4>

<p>Doing this, the configuration of the VAS and VMS is done. We can now launch both VISOR subsystems with the following commands:</p>

<pre class="code ruby"><code>prompt $&gt; visor-auth start -d -f
Starting visor-auth at 0.0.0.0:4566
[2012-06-10 17:42:51] INFO - Starting visor-auth at 0.0.0.0:4566
[2012-06-10 17:42:51] DEBUG - Configs from /Users/joaodrp/.visor/visor-config.yml:
[2012-06-10 17:42:51] DEBUG - ***************************************************
[2012-06-10 17:42:51] DEBUG - log_datetime_format: %Y-%m-%d %H:%M:%S
[2012-06-10 17:42:51] DEBUG - log_path: ~/.visor/logs
[2012-06-10 17:42:51] DEBUG - access_key: foo
[2012-06-10 17:42:51] DEBUG - secret_key: P1qGJkJqWNEwwpSyWbh4cUljxkxbdTwen6m/pwF2
[2012-06-10 17:42:51] DEBUG - bind_host: 0.0.0.0
[2012-06-10 17:42:51] DEBUG - bind_port: 4566
[2012-06-10 17:42:51] DEBUG - backend: mongodb://:@127.0.0.1:27017/visor
[2012-06-10 17:42:51] DEBUG - log_file: visor-auth-server.log
[2012-06-10 17:42:51] DEBUG - log_level: INFO
[2012-06-10 17:42:51] DEBUG - file: /Users/joaodrp/.visor/visor-config.yml
[2012-06-10 17:42:51] DEBUG - ***************************************************
[2012-06-10 17:42:51] DEBUG - Configurations passed from visor-auth CLI:
[2012-06-10 17:42:51] DEBUG - ***************************************************
[2012-06-10 17:42:51] DEBUG - debug: true
[2012-06-10 17:42:51] DEBUG - foreground: true
[2012-06-10 17:42:51] DEBUG - ***************************************************
prompt $&gt; 
</code></pre>

<p>In the above output we have started the VAS in debug mode. We have also started it in foreground, therefore the process will remain on the terminal, debugging to it. If wanting to start it in foreground, it can be done by omitting the <code>-f</code> option:</p>

<pre class="code ruby"><code>prompt $&gt; visor-auth start
Starting visor-auth at 0.0.0.0:4566
prompt $&gt; 
</code></pre>

<p>To stop the VAS when it was started as a daemon process, it can be done using the stop command:</p>

<pre class="code ruby"><code>prompt $&gt; visor-auth stop
Stopping visor-auth with PID: 41466 Signal: INT
prompt $&gt; 
</code></pre>

<p>In this case the VAS server process was running with the process identifier (PID) 41466 and was killed using the interrupt flag (INT). To see more options to control the VAS you can use the command help:</p>

<pre class="code ruby"><code>prompt $&gt; visor-auth 
Usage: visor-auth [OPTIONS] COMMAND

Commands:
     start        start the server
     stop         stop the server
     restart      restart the server
     status       current server status

Options:
    -c, --config FILE                Load a custom configuration file
    -o, --host HOST                  listen on HOST (default: 0.0.0.0)
    -p, --port PORT                  use PORT (default: 4566)
    -x, --no-proxy                   ignore proxy settings if any
    -e, --env ENVIRONMENT            use ENVIRONMENT for defaults (default: production)
    -F, --foreground                 don't daemonize, run in the foreground

Common options:
    -d, --debug                      Set debugging on (with foreground only)
    -h, --help                       Show this message
    -v, --version                    Show version
prompt $&gt; 
</code></pre>

<p>All these operations apply to all VISOR subsystem (less the VISOR Common and Web Systems). Thus, to start the VMS use the following command:</p>

<pre class="code ruby"><code>prompt $&gt; visor-meta start
Starting visor-meta at 0.0.0.0:4567
prompt $&gt; 
</code></pre>

<p>Now we have finished the VAS and VMS configurations and they are up and running.</p>
</div></div>

    <div id="footer">
  Generated on Sun Jun 24 13:10:08 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.1 (ruby-1.9.3).
</div>

  </body>
</html>