<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Visor::API::Server
  
    &mdash; VISoR
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Visor.html" title="Visor (module)">Visor</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../API.html" title="Visor::API (module)">API</a></span></span>
     &raquo; 
    <span class="title">Server</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Visor::API::Server
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Goliath::API</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Goliath::API</li>
          
            <li class="next">Visor::API::Server</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">api/lib/api/server.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The VISoR API Server. This supports all image metadata manipulation
operations, dispatched to the VISoR Meta Server and the image files storage
operations.</p>

<p>*The Server API is a RESTful web service for image meta as follows:*</p>

<pre class="code">HEAD    /images/&lt;id&gt;    - Returns metadata about the image with the given id
GET     /images         - Returns a set of brief metadata about all public images
GET     /images/detail  - Returns a set of detailed metadata about all public images
GET     /images/&lt;id&gt;    - Returns image data and metadata for the image with the given id
POST    /images         - Stores a new image data and metadata and returns the registered metadata
PUT     /images/&lt;id&gt;    - Update image metadata and/or data for the image with the given id
DELETE  /images/&lt;id&gt;    - Delete the metadata and data of the image with the given id</pre>

<p>The API is multi-format, most properly it supports response encoding in
JSON and XML formats. It will auto negotiate and encode the response
metadata and error messages in the proper format, based on the request
<b>Accept</b> header, being it 'application/json' or 'application/xml'. If
no Accept header is provided, API will encode and render it as JSON by
default.</p>

<p>This server routes all metadata operations to the <span class='object_link'><a href="../Meta/Server.html" title="Visor::Meta::Server (class)">Visor Meta Server</a></span>.</p>

<p>The server will interact with the multiple supported backend store to
manage the image files.</p>

<p>*Currently we support the following store backend and operations:*</p>

<pre class="code"><span class='const'>Amazon</span> <span class='const'>Simple</span> <span class='const'>Storage</span> <span class='lparen'>(</span><span class='id identifier rubyid_s3'>s3</span><span class='rparen'>)</span>    <span class='op'>-</span> <span class='const'>GET</span><span class='comma'>,</span> <span class='const'>POST</span><span class='comma'>,</span> <span class='const'>PUT</span><span class='comma'>,</span> <span class='const'>DELETE</span>
<span class='const'>Local</span> <span class='const'>Filesystem</span>      <span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>  <span class='op'>-</span> <span class='const'>GET</span><span class='comma'>,</span> <span class='const'>POST</span><span class='comma'>,</span> <span class='const'>PUT</span><span class='comma'>,</span> <span class='const'>DELETE</span>
<span class='const'>Remote</span> <span class='const'>HTTP</span>           <span class='lparen'>(</span><span class='id identifier rubyid_http'>http</span><span class='rparen'>)</span>  <span class='op'>-</span> <span class='const'>GET</span></pre>


  </div>
</div>
<div class="tags">
  

</div>

  


  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (JSON, XML) <strong>delete</strong>('/images/:id') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Delete the metadata and data of the image with the given id, see
<span class='object_link'><a href="DeleteImage.html" title="Visor::API::DeleteImage (class)">DeleteImage</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_all_brief-instance_method" title="#get (instance method)">- (JSON, XML) <strong>get</strong>('/images') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get brief information about all public images, see <span class='object_link'><a href="GetImages.html" title="Visor::API::GetImages (class)">GetImages</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_all_detail-instance_method" title="#get (instance method)">- (JSON, XML) <strong>get</strong>('/images/detail') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get detailed information about all public images, see
<span class='object_link'><a href="GetImagesDetail.html" title="Visor::API::GetImagesDetail (class)">GetImagesDetail</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_image-instance_method" title="#get (instance method)">- (HTTP Headers, HTTP Body) <strong>get</strong>('/images/:id') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get image data and detailed metadata for the given id, see
<span class='object_link'><a href="GetImage.html" title="Visor::API::GetImage (class)">GetImage</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#head_image-instance_method" title="#head (instance method)">- (HTTP Headers) <strong>head</strong>('/image/:id') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Head metadata about the image with the given id, see
<span class='object_link'><a href="HeadImage.html" title="Visor::API::HeadImage (class)">HeadImage</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post-instance_method" title="#post (instance method)">- (JSON, XML) <strong>post</strong>('/images') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Post image data and metadata and returns the registered metadata, see
<span class='object_link'><a href="PostImage.html" title="Visor::API::PostImage (class)">PostImage</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put-instance_method" title="#put (instance method)">- (JSON, XML) <strong>put</strong>('/images/:id') </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Put image metadata and/or data for the image with the given id, see
<span class='object_link'><a href="PutImage.html" title="Visor::API::PutImage (class)">PutImage</a></span>.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="delete-instance_method">
  
    - (<tt>JSON</tt>, <tt>XML</tt>) <strong>delete</strong>('/images/:id') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Delete the metadata and data of the image with the given id, see
<span class='object_link'><a href="DeleteImage.html" title="Visor::API::DeleteImage (class)">DeleteImage</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'>
<p>Delete the image with id '19b39ed6-6c43-41cc-8d59-d1a1ed24ac9d':</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>DELETE /images/19b39ed6-6c43-41cc-8d59-d1a1ed24ac9d</span><span class='tstring_end'>'</span></span></pre>
    
  </div>

  
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The image _id to delete.</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>, <tt>XML</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The already deleted image detailed metadata.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If image meta or data not found.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 403</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If user does not have permission to manipulate the image file.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 296</span>

<span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images/:id</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>DeleteImage</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_all_brief-instance_method">
  
    - (<tt>JSON</tt>, <tt>XML</tt>) <strong>get</strong>('/images') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Get brief information about all public images, see <span class='object_link'><a href="GetImages.html" title="Visor::API::GetImages (class)">GetImages</a></span>.</p>

<pre class="code">{ &quot;images&quot;:
  [
    {
      &quot;_id&quot;:&lt;_id&gt;,
      &quot;uri&quot;:&lt;uri&gt;,
      &quot;name&quot;:&lt;name&gt;,
      &quot;architecture&quot;:&lt;architecture&gt;,
      &quot;type&quot;:&lt;type&gt;,
      &quot;format&quot;:&lt;format&gt;,
      &quot;store&quot;:&lt;type&gt;,
      &quot;size&quot;:&lt;size&gt;,
      &quot;created_at&quot;:&lt;timestamp&gt;
    },
    ...
  ]
}</pre>

<p>The following options can be passed as query parameters, plus any other
additional image attribute not defined in the schema.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'>
<p>Retrieve all public images brief metadata:</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GET /images</span><span class='tstring_end'>'</span></span></pre>
    
      <h4><div class='inline'>
<p>Retrieve all public `x86_64` images brief metadata:</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GET /images?architecture=x86_64</span><span class='tstring_end'>'</span></span></pre>
    
      <h4><div class='inline'>
<p>Retrieve all public `.iso` images brief metadata, descending sorted by
`size`:</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GET /images?format=iso&amp;sort=size&amp;dir=desc</span><span class='tstring_end'>'</span></span></pre>
    
  </div>

  
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>parameter</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Integer</tt>, <tt>Date</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The image attribute to filter results based on its value.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sort</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>("_id") The image attribute to sort results.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>("asc") The sorting order ("asc"/"desc").</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>, <tt>XML</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The public images brief metadata.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If there is no public images.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 127</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>GetImages</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_all_detail-instance_method">
  
    - (<tt>JSON</tt>, <tt>XML</tt>) <strong>get</strong>('/images/detail') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong> 
    <div class='inline'>
<p>Querying and ordering results are made as with #get_all_detail</p>
</div>
  </div>


<p>Get detailed information about all public images, see
<span class='object_link'><a href="GetImagesDetail.html" title="Visor::API::GetImagesDetail (class)">GetImagesDetail</a></span>.</p>

<pre class="code">{ &quot;images&quot;:
  [
    {
      &quot;_id&quot;:&lt;_id&gt;,
      &quot;uri&quot;:&lt;uri&gt;,
      &quot;name&quot;:&lt;name&gt;,
      &quot;architecture&quot;:&lt;architecture&gt;,
      &quot;access&quot;:&lt;access&gt;,
      &quot;status&quot;:&lt;status&gt;,
      &quot;size&quot;:&lt;size&gt;,
      &quot;type&quot;:&lt;type&gt;,
      &quot;format&quot;:&lt;format&gt;,
      &quot;store&quot;:&lt;store&gt;,
      &quot;created_at&quot;:&lt;timestamp&gt;
      &quot;updated_at&quot;:&lt;timestamp&gt;,
      &quot;kernel&quot;:&lt;associated kernel&gt;,
      &quot;ramdisk&quot;:&lt;associated ramdisk&gt;,
    },
    ...
  ]
}</pre>

<p>The following options can be passed as query parameters, plus any other
additional image attribute not defined in the schema.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'>
<p>Retrieve all public images detailed metadata:</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GET /images/detail</span><span class='tstring_end'>'</span></span></pre>
    
  </div>

  
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>parameter</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Integer</tt>, <tt>Date</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The image attribute to filter results based on its value.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sort</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>("_id") The image attribute to sort results.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>("asc") The sorting order ("asc"/"desc").</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>, <tt>XML</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The public images detailed metadata.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If there is no public images.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 174</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images/detail</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>GetImagesDetail</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_image-instance_method">
  
    - (<tt>HTTP Headers</tt>, <tt>HTTP Body</tt>) <strong>get</strong>('/images/:id') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong> 
    <div class='inline'>
<p>Undefined attributes are ignored and not included into response's header.</p>
</div>
  </div>


<p>Get image data and detailed metadata for the given id, see
<span class='object_link'><a href="GetImage.html" title="Visor::API::GetImage (class)">GetImage</a></span>.</p>

<p>The image data file is streamed as response's body. The server will return
a 200 status code, with a special HTTP header, indicating that the response
body will be streamed in chunks and connection shouldn't be closed until
the transfer is complete.</p>

<p>Also, the image metadata is promptly passed as a set of HTTP headers, as
the following example:</p>

<pre class="code">x-image-meta-_id:           &lt;id&gt;
x-image-meta-uri:           &lt;uri&gt;
x-image-meta-name:          &lt;name&gt;
x-image-meta-architecture:  &lt;architecture&gt;
x-image-meta-access:        &lt;access&gt;
x-image-meta-status:        &lt;status&gt;
x-image-meta-created_at:    &lt;timestamp&gt;</pre>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'>
<p>Retrieve the image with id '19b39ed6-6c43-41cc-8d59-d1a1ed24ac9d':</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GET /images/19b39ed6-6c43-41cc-8d59-d1a1ed24ac9d</span><span class='tstring_end'>'</span></span></pre>
    
  </div>

  
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The wanted image _id.</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Headers</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The image data file.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Body</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The image data file.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If image not found.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 209</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images/:id</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>GetImage</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="head_image-instance_method">
  
    - (<tt>HTTP Headers</tt>) <strong>head</strong>('/image/:id') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong> 
    <div class='inline'>
<p>Undefined attributes are ignored and not included into response's header.
Also any raised error will be passed through HTTP headers as expected.</p>
</div>
  </div>


<p>Head metadata about the image with the given id, see
<span class='object_link'><a href="HeadImage.html" title="Visor::API::HeadImage (class)">HeadImage</a></span>.</p>

<p>The image metadata is promptly passed as a set of HTTP headers, as the
following example:</p>

<pre class="code">x-image-meta-_id:           &lt;id&gt;
x-image-meta-uri:           &lt;uri&gt;
x-image-meta-name:          &lt;name&gt;
x-image-meta-architecture:  &lt;architecture&gt;
x-image-meta-access:        &lt;access&gt;
x-image-meta-status:        &lt;status&gt;
x-image-meta-created_at:    &lt;timestamp&gt;</pre>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'>
<p>Retrieve the image metadata with id '19b39ed6-6c43-41cc-8d59-d1a1ed24ac9d':</p>
</div></h4>
      <pre class="example code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>HEAD /images/19b39ed6-6c43-41cc-8d59-d1a1ed24ac9d</span><span class='tstring_end'>'</span></span></pre>
    
  </div>

  
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The wanted image _id.</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Headers</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The image data file.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If image not found.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 81</span>

<span class='id identifier rubyid_head'>head</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images/:id</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>HeadImage</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="post-instance_method">
  
    - (<tt>JSON</tt>, <tt>XML</tt>) <strong>post</strong>('/images') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Post image data and metadata and returns the registered metadata, see
<span class='object_link'><a href="PostImage.html" title="Visor::API::PostImage (class)">PostImage</a></span>.</p>

<p>The image metadata should be encoded as HTTP headers and passed with the
request, as the following example:</p>

<pre class="code">x-image-meta-name:          Ubuntu 10.10 Desktop
x-image-meta-architecture:  i386
x-image-meta-store:         s3</pre>

<p>If wanted, the image data file should be streamed through the request body.
The server will receive that data in chunks, buffering them to a properly
secured temporary file, avoiding buffering all the data into memory. Server
will then handle the upload of that data to the definitive store location,
cleaning then the generated temporary file.</p>

<p>Alternatively, a <b>x-image-meta-location</b> header can be passed, if the
file is already stored in some provided location. If this header is
present, no body content can be passed in the request.</p>


  </div>
</div>
<div class="tags">
  
  

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>, <tt>XML</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The already created image detailed metadata.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the image metadata validation fails.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the location header is present no file content can be provided.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If trying to post an image file to a HTTP backend.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If provided store is an unsupported store backend.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If no image data is found at the provided location.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 409</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the provided image file already exists in the backend store.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 241</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>PostImage</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="put-instance_method">
  
    - (<tt>JSON</tt>, <tt>XML</tt>) <strong>put</strong>('/images/:id') 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong> 
    <div class='inline'>
<p>Only images with status set to 'locked' or 'error' can be updated with an
image data file.</p>
</div>
  </div>


<p>Put image metadata and/or data for the image with the given id, see
<span class='object_link'><a href="PutImage.html" title="Visor::API::PutImage (class)">PutImage</a></span>.</p>

<p>The image metadata should be encoded as HTTP headers and passed with the
request, as the following example:</p>

<pre class="code">x-image-meta-name:          Ubuntu 10.10 Server
x-image-meta-architecture:  x86_64
x-image-meta-location:      http://www.ubuntu.com/start-download?distro=server&amp;bits=64&amp;release=latest</pre>

<p>If wanted, the image data file should be streamed through the request body.
The server will receive that data in chunks, buffering them to a properly
secured temporary file, avoiding buffering all the data into memory. Server
will then handle the upload of that data to the definitive store location,
cleaning then the generated temporary file.</p>

<p>Alternatively, a <b>x-image-meta-location</b> header can be passed, if the
file is already stored in some provided location. If this header is
present, no body content can be passed in the request.</p>


  </div>
</div>
<div class="tags">
  
  

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>, <tt>XML</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The already updated image detailed metadata.</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the image metadata validation fails.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If no headers neither body found for update.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the location header is present no file content can be provided.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If trying to post an image file to a HTTP backend.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 400</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If provided store is an unsupported store backend.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 404</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If no image data is found at the provided location.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 409</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If trying to assign image file to a locked or uploading image.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 409</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the provided image file already exists in the backend store.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>HTTP Error 500</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>On internal server error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'api/lib/api/server.rb', line 277</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/images/:id</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='const'>PutImage</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Feb 27 20:23:56 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.3).
</div>

  </body>
</html>